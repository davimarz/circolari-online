name: Reset Database

on:
  workflow_dispatch:  # Solo esecuzione manuale

jobs:
  reset-db:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: pip install psycopg2-binary
    
    - name: Reset Database
      run: |
        echo "ğŸ—‘ï¸  RESET DATABASE"
        echo "====================="
        
        python3 -c "
import psycopg2

# DATABASE CONFIG - CREDENZIALI HARCODED
DATABASE_URL = 'postgresql://postgres:TpsVpUowNnMqSXpvAosQEezxpGPtbPNG@postgres.railway.internal:5432/railway'

try:
    print('ğŸ”— Connessione al database...')
    conn = psycopg2.connect(DATABASE_URL)
    cursor = conn.cursor()
    
    # Conta prima
    cursor.execute('SELECT COUNT(*) FROM circolari')
    count_prima = cursor.fetchone()[0]
    print(f'ğŸ“Š Circolari prima: {count_prima}')
    
    if count_prima > 0:
        # Elimina tutto
        cursor.execute('DELETE FROM circolari')
        conn.commit()
        
        # Conta dopo
        cursor.execute('SELECT COUNT(*) FROM circolari')
        count_dopo = cursor.fetchone()[0]
        
        print(f'âœ… Eliminate {count_prima} circolari')
        print(f'ğŸ“Š Circolari dopo: {count_dopo}')
    else:
        print('ğŸ“­ Database giÃ  vuoto')
    
    conn.close()
    print('ğŸ¯ Database resettato con successo!')
    
except Exception as e:
    print(f'âŒ Errore: {e}')
        "
